{% extends "base.html" %}

{% block content %}
    {% if not task_list %}
        <h1>No tasks to show</h1>
    {% else %}
        <div class="tasks-container d-flex justify-content-center gap-3">
             {% for task in task_list %}
                <div class="task-card d-flex" onclick="this.classList.toggle('flipped')">
                  <div class="task-card-inner">
                    <div class="task-card-front">
                      <h3>{{ task.name }}</h3>
                      <p class="date">Created at: {{ task.created_at }}</p>
                      <p class="status">Status: {{ task.status }}</p>
                        {% if task.accomplished_at %}
                            <p class="date">{{ task.accomplished_at }}</p>
                        {% else %}
                            <p class="due-date">Due by: {{ task.due_by|date:"Y-m-d" }}</p>
                        {% endif %}
                        <button type="button" class="btn btn-success complete-btn" data-task-id="{{ task.pk }}">
                            Mark as Completed
                        </button>
                    </div>
                    <div class="task-card-back">
                      <p class="desc">{{ task.description }}</p>
                    </div>
                  </div>
                </div>

            {% endfor %}
        </div>

    {% endif %}
<script>
const dueDateElements = document.querySelectorAll('.due-date');

dueDateElements.forEach(el => {
    const text = el.textContent;
    const dateStr = text.replace('Due by: ', '').trim();
    const dueDate = new Date(dateStr);
    const today = new Date();

    const diffTime = dueDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    if (diffDays >= 3) {
        el.style.color = 'green';
    } else if (diffDays === 2){
        el.style.color ='orange';
    } else if (diffDays <= 1) {
        el.style.color = 'red';
    }
});


</script>

{% endblock %}